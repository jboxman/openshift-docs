= Authentication and authorization

toc::[]


## Using bound service account tokens

[source,terminal]
----
$ oc edit authentications cluster
----


[source,terminal]
----
$ oc create -f pod-projected-svc-token.yaml
----

## Creating and using config maps

[source,terminal]
----
$ oc create configmap <configmap_name> [options]
----


[source,terminal]
----
$ oc create configmap game-config \
    --from-file=example-files/
----


[source,terminal]
----
$ oc create configmap game-config-2 \
    --from-file=example-files/game.properties \
    --from-file=example-files/ui.properties
----


[source,terminal]
----
$ oc create configmap game-config-3 \
    --from-file=game-special-key=example-files/game.properties
----


[source,terminal]
----
$ oc create configmap special-config \
    --from-literal=special.how=very \
    --from-literal=special.type=charm
----

## Configuring the internal OAuth server

[source,terminal]
----
$ oc apply -f </path/to/file.yaml>
----


[source,terminal]
----
$ oc edit oauth cluster
----

## Configuring OAuth clients

[source,terminal]
----
$ oc edit oauthclient <oauth_client> 
----

## Configuring a basic authentication identity provider

[source,terminal]
----
$ oc create secret generic <secret_name> --from-literal=clientSecret=<secret> -n openshift-config
----


[source,terminal]
----
$ oc create secret generic <secret_name> --from-file=/path/to/file -n openshift-config
----


[source,terminal]
----
$ oc create configmap ca-config-map --from-file=ca.crt=/path/to/ca -n openshift-config
----


[source,terminal]
----
$ oc apply -f </path/to/CR>
----

## Configuring a GitLab identity provider

[source,terminal]
----
$ oc create secret generic <secret_name> --from-literal=clientSecret=<secret> -n openshift-config
----


[source,terminal]
----
$ oc create secret generic <secret_name> --from-file=/path/to/file -n openshift-config
----


[source,terminal]
----
$ oc create configmap ca-config-map --from-file=ca.crt=/path/to/ca -n openshift-config
----


[source,terminal]
----
$ oc apply -f </path/to/CR>
----

## Configuring an HTPasswd identity provider

[source,terminal]
----
$ oc create secret generic htpass-secret --from-file=htpasswd=</path/to/users.htpasswd> -n openshift-config
----


[source,terminal]
----
$ oc apply -f </path/to/CR>
----


[source,terminal]
----
$ oc create secret generic htpass-secret --from-file=htpasswd=users.htpasswd --dry-run=client -o yaml -n openshift-config | oc replace -f -
----


[source,terminal]
----
$ oc delete user <username>
----


[source,terminal]
----
$ oc delete identity my_htpasswd_provider:<username>
----

## Configuring a Keystone identity provider

[source,terminal]
----
$ oc create secret generic <secret_name> --from-literal=clientSecret=<secret> -n openshift-config
----


[source,terminal]
----
$ oc create secret generic <secret_name> --from-file=/path/to/file -n openshift-config
----


[source,terminal]
----
$ oc create configmap ca-config-map --from-file=ca.crt=/path/to/ca -n openshift-config
----


[source,terminal]
----
$ oc apply -f </path/to/CR>
----

## Configuring a request header identity provider

[source,terminal]
----
$ oc create configmap ca-config-map --from-file=ca.crt=/path/to/ca -n openshift-config
----


[source,terminal]
----
$ oc apply -f </path/to/CR>
----


[source,terminal]
----
$ oc create configmap ca-config-map --from-file=ca.crt=/path/to/ca -n openshift-config
----

## Impersonating the system:admin user

[source,terminal]
----
$ oc create clusterrolebinding <any_valid_name> --clusterrole=sudoer --user=<username>
----


[source,terminal]
----
$ oc create clusterrolebinding <any_valid_name> --clusterrole=sudoer --as=<user> \
--as-group=<group1> --as-group=<group2>
----

## Syncing LDAP groups

[source,terminal]
----
$ oc adm groups sync --sync-config=config.yaml --confirm
----


[source,terminal]
----
$ oc adm groups sync --type=openshift --sync-config=config.yaml --confirm
----


[source,terminal]
----
$ oc adm groups sync --whitelist=<whitelist_file> \
                   --sync-config=config.yaml      \
                   --confirm
----


[source,terminal]
----
$ oc adm groups sync --blacklist=<blacklist_file> \
                   --sync-config=config.yaml      \
                   --confirm
----


[source,terminal]
----
$ oc adm groups sync <group_unique_identifier>    \
                   --sync-config=config.yaml      \
                   --confirm
----


[source,terminal]
----
$ oc adm groups sync <group_unique_identifier>  \
                   --whitelist=<whitelist_file> \
                   --blacklist=<blacklist_file> \
                   --sync-config=config.yaml    \
                   --confirm
----


[source,terminal]
----
$ oc adm groups sync --type=openshift           \
                   --whitelist=<whitelist_file> \
                   --sync-config=config.yaml    \
                   --confirm
----


[source,terminal]
----
$ oc adm prune groups --sync-config=/path/to/ldap-sync-config.yaml --confirm
----


[source,terminal]
----
$ oc adm prune groups --whitelist=/path/to/whitelist.txt --sync-config=/path/to/ldap-sync-config.yaml --confirm
----


[source,terminal]
----
$ oc adm prune groups --blacklist=/path/to/blacklist.txt --sync-config=/path/to/ldap-sync-config.yaml --confirm
----


[source,terminal]
----
$ oc adm groups sync --sync-config=rfc2307_config.yaml --confirm
----


[source,terminal]
----
$ oc adm groups sync --sync-config=rfc2307_config_user_defined.yaml --confirm
----


[source,terminal]
----
$ oc adm groups sync --sync-config=rfc2307_config_tolerating.yaml --confirm
----


[source,terminal]
----
$ oc adm groups sync --sync-config=active_directory_config.yaml --confirm
----


[source,terminal]
----
$ oc adm groups sync --sync-config=augmented_active_directory_config.yaml --confirm
----


[source,terminal]
----
$ oc adm groups sync \
    'cn=admins,ou=groups,dc=example,dc=com' \
    --sync-config=augmented_active_directory_config_nested.yaml \
    --confirm
----

## Managing user-owned OAuth access tokens

[source,terminal]
----
$ oc delete useroauthaccesstokens <token_name>
----

## Using mint mode

[source,terminal]
----
$ oc delete secret <secret_name> -n <secret_namespace>
----


[source,terminal]
----
$ oc delete secret ebs-cloud-credentials -n openshift-cluster-csi-drivers
----

## Using manual mode with STS

[source,terminal]
----
$ oc adm release extract quay.io/openshift-release-dev/ocp-release:4.<y>.<z>-x86_64 --credentials-requests --cloud=aws
----

## Removing the kubeadmin user

[source,terminal]
----
$ oc delete secrets kubeadmin -n kube-system
----

## Understanding and creating service accounts

[source,terminal]
----
$ oc create sa <service_account_name> 
----


[source,terminal]
----
$ oc policy add-role-to-user view system:serviceaccount:top-secret:robot
----


[source,terminal]
----
$ oc policy add-role-to-user <role_name> -z <service_account_name>
----


[source,terminal]
----
$ oc policy add-role-to-group view system:serviceaccounts -n top-secret
----


[source,terminal]
----
$ oc policy add-role-to-group edit system:serviceaccounts:managers -n top-secret
----

## Understanding identity provider configuration

[source,terminal]
----
$ oc delete secrets kubeadmin -n kube-system
----

## Using RBAC to define and apply permissions

[source,terminal]
----
$ oc adm policy add-role-to-user <role> <user> -n <project>
----


[source,terminal]
----
$ oc adm policy add-role-to-user admin alice -n joe
----

## Using service accounts in applications

[source,terminal]
----
$ oc create sa <service_account_name> 
----
