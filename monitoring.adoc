= Monitoring

toc::[]


## Application monitoring

[source,terminal]
----
$ oc apply -f deploy.yaml
----


[source,terminal]
----
$ oc port-forward -n openshift-user-workload-monitoring svc/prometheus-operated 9090
----


[source,terminal]
----
$ oc apply -f deploy.yaml
----

## Configuring HPA for an application

[source,terminal]
----
$ oc apply -f deploy.yaml
----

## Configuring the monitoring stack

[source,terminal]
----
$ oc apply -f cluster-monitoring-config.yaml
----


[source,terminal]
----
$ oc apply -f user-workload-monitoring-config.yaml
----


[source,terminal]
----
$ oc -n openshift-monitoring edit configmap cluster-monitoring-config
----


[source,terminal]
----
$ oc -n openshift-user-workload-monitoring edit configmap user-workload-monitoring-config
----


[source,terminal]
----
$ oc -n openshift-monitoring edit configmap cluster-monitoring-config
----


[source,terminal]
----
$ oc -n openshift-user-workload-monitoring edit configmap user-workload-monitoring-config
----


[source,terminal]
----
$ oc -n openshift-monitoring edit configmap cluster-monitoring-config
----


[source,terminal]
----
$ oc -n openshift-user-workload-monitoring edit configmap user-workload-monitoring-config
----


[source,terminal]
----
$ oc -n openshift-monitoring edit configmap cluster-monitoring-config
----


[source,terminal]
----
$ oc -n openshift-user-workload-monitoring edit configmap user-workload-monitoring-config
----


[source,terminal]
----
$ oc -n openshift-monitoring edit configmap cluster-monitoring-config
----


[source,terminal]
----
$ oc -n openshift-user-workload-monitoring edit configmap user-workload-monitoring-config
----


[source,terminal]
----
$ oc -n openshift-user-workload-monitoring edit configmap user-workload-monitoring-config
----


[source,terminal]
----
$ oc apply -f monitoring-stack-alerts.yaml
----


[source,terminal]
----
$ oc -n openshift-monitoring edit configmap cluster-monitoring-config
----


[source,terminal]
----
$ oc -n openshift-user-workload-monitoring edit configmap user-workload-monitoring-config
----


[source,terminal]
----
$ oc -n openshift-monitoring edit configmap cluster-monitoring-config
----


[source,terminal]
----
$ oc -n openshift-user-workload-monitoring edit configmap user-workload-monitoring-config
----

## Enabling monitoring for user-defined projects

[source,terminal]
----
$ oc -n openshift-monitoring edit configmap cluster-monitoring-config
----


[source,terminal]
----
$ oc policy add-role-to-user <role> <user> -n <namespace> 
----


[source,terminal]
----
$ oc -n openshift-user-workload-monitoring adm policy add-role-to-user \
  user-workload-monitoring-config-edit <user> \
  --role-namespace openshift-user-workload-monitoring
----


[source,terminal]
----
$ oc -n openshift-monitoring edit configmap cluster-monitoring-config
----

## Exposing custom application metrics for autoscaling

[source,terminal]
----
$ oc apply -f deploy.yaml
----

## Managing alerts

[source,terminal]
----
$ oc apply -f example-app-alerting-rule.yaml
----


[source,terminal]
----
$ oc apply -f example-app-alerting-rule.yaml
----


[source,terminal]
----
$ oc -n <namespace> delete prometheusrule <foo>
----


[source,terminal]
----
$ oc -n openshift-monitoring create secret generic alertmanager-main --from-file=alertmanager.yaml --dry-run -o=yaml |  oc -n openshift-monitoring replace secret --filename=-
----

## Managing metrics

[source,terminal]
----
$ oc apply -f prometheus-example-app.yaml
----


[source,terminal]
----
$ oc apply -f example-app-service-monitor.yaml
----

## Troubleshooting monitoring issues

[source,terminal]
----
$ oc port-forward -n openshift-user-workload-monitoring pod/prometheus-user-workload-0 9090
----


[source,terminal]
----
$ oc -n openshift-user-workload-monitoring edit configmap user-workload-monitoring-config
----
